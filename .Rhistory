ethnicity = "Total",
education = case_when(
education %in% c("Less than 9th grade", "9th to 12th grade, no diploma") ~ "Less than high school diploma",
education == "High school graduate (includes equivalency)" ~ education,
education %in% c("Some college, no degree", "Associate's degree") ~ "Some college or associate's degree",
education %in% c("Bachelor's degree", "Graduate or professional degree") ~ "Bachelor's degree or higher"
)
)
View(bay_educ_race_1yr)
View(bay_educ_race_1yr)
bay_educ_race_1yr <-
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "county:085",
regionin = "state:06",
vars = "group(C15002)"
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(
ethnicity = "Total",
education = case_when(
education %in% c("Less than 9th grade", "9th to 12th grade, no diploma") ~ "Less than high school diploma",
education == "High school graduate (includes equivalency)" ~ education,
education %in% c("Some college, no degree", "Associate's degree") ~ "Some college or associate's degree",
education %in% c("Bachelor's degree", "Graduate or professional degree") ~ "Bachelor's degree or higher"
)
)%>%
group_by(education, county, ethnicity) %>%
summarize_all(sum)
View(bay_educ_race_1yr)
View(bay_educ_race_1yr)
bay_educ_total <-
bay_educ_race_1yr %>%
group_by(education) %>%
summarize(estimate = sum(estimate)) %>%
mutate(
race = "Total"
)
View(bay_educ_total)
View(bay_educ_total)
View(bay_educ_total)
View(bay_educ_total)
bay_educ_neither <-
bay_educ_race_1yr %>%
mutate(
neither = estimate - bay_educ_white$estimate - bay_educ_latinx$estimate,
race = "Not white, not latinx"
)%>%
select(-estimate)%>%
rename(estimate = neither)
bay_educ_neither <-
bay_educ_total %>%
mutate(
neither = estimate - bay_educ_white$estimate - bay_educ_latinx$estimate,
race = "Not white, not latinx"
)%>%
select(-estimate)%>%
rename(estimate = neither)
plot_stacked_latinx <-
bay_educ_neither %>%
#group_by(education, race) %>%
#summarize(estimate = sum(estimate)) %>%
rbind(bay_educ_white) %>%
rbind(bay_educ_latinx) %>%
ggplot() +
geom_bar(
aes(
x = education %>% factor(levels = rev(c("Less than high school diploma", "High school graduate (includes equivalency)", "Some college or associate's degree", "Bachelor's degree or higher"))),
y = estimate,
fill = race
),
stat = "identity",
position = "stack"
) +
labs(
x = "Level of Educational Attainment",
y = "Number of individuals",
title = "Santa Clara educational attainment by ethnicity",
fill = "Ethnicity of individual"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
plot_stacked_latinx
bay_educ_race_1yr <-
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "county:085",
regionin = "state:06",
vars = "group(C15002)"
) %>%
select(!c(GEO_ID,state, NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(
ethnicity = "Total",
education = case_when(
education %in% c("Less than 9th grade", "9th to 12th grade, no diploma") ~ "Less than high school diploma",
education == "High school graduate (includes equivalency)" ~ education,
education %in% c("Some college, no degree", "Associate's degree") ~ "Some college or associate's degree",
education %in% c("Bachelor's degree", "Graduate or professional degree") ~ "Bachelor's degree or higher"
)
)%>%
group_by(education, county, ethnicity) %>%
summarize_all(sum)
View(bay_educ_race_1yr)
View(bay_educ_race_1yr)
View(bay_educ_total)
View(bay_educ_total)
bay_educ_white_loop <-
2006:2019 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = x,
region = "county:085",
regionin = "state:06",
vars = "group(C15002)"
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(
ethnicity = "Total",
education = case_when(
education %in% c("Less than 9th grade", "9th to 12th grade, no diploma") ~ "Less than high school diploma",
education == "High school graduate (includes equivalency)" ~ education,
education %in% c("Some college, no degree", "Associate's degree") ~ "Some college or associate's degree",
education %in% c("Bachelor's degree", "Graduate or professional degree") ~ "Bachelor's degree or higher"
)
)%>%
group_by(education, county, ethnicity) %>%
summarize_all(sum)
})
bay_educ_white_loop <-
2006:2019 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = x,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(C15002H)"
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(
ethnicity = "Total",
education = case_when(
education %in% c("Less than 9th grade", "9th to 12th grade, no diploma") ~ "Less than high school diploma",
education == "High school graduate (includes equivalency)" ~ education,
education %in% c("Some college, no degree", "Associate's degree") ~ "Some college or associate's degree",
education %in% c("Bachelor's degree", "Graduate or professional degree") ~ "Bachelor's degree or higher"
)
)%>%
group_by(education, county, ethnicity) %>%
summarize_all(sum)
})
bay_educ_latinx_loop <-
2006:2019 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = x,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(C15002H=I)"
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(
ethnicity = "Total",
education = case_when(
education %in% c("Less than 9th grade", "9th to 12th grade, no diploma") ~ "Less than high school diploma",
education == "High school graduate (includes equivalency)" ~ education,
education %in% c("Some college, no degree", "Associate's degree") ~ "Some college or associate's degree",
education %in% c("Bachelor's degree", "Graduate or professional degree") ~ "Bachelor's degree or higher"
)
)%>%
group_by(education, county, ethnicity) %>%
summarize_all(sum)
})
bay_educ_latinx_loop <-
2006:2019 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = x,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(C15002I)"
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(
ethnicity = "Total",
education = case_when(
education %in% c("Less than 9th grade", "9th to 12th grade, no diploma") ~ "Less than high school diploma",
education == "High school graduate (includes equivalency)" ~ education,
education %in% c("Some college, no degree", "Associate's degree") ~ "Some college or associate's degree",
education %in% c("Bachelor's degree", "Graduate or professional degree") ~ "Bachelor's degree or higher"
)
)%>%
group_by(education, county, ethnicity) %>%
summarize_all(sum)
})
bay_educ_total_loop <-
2006:2019 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = x,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(C15002)"
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(
ethnicity = "Total",
education = case_when(
education %in% c("Less than 9th grade", "9th to 12th grade, no diploma") ~ "Less than high school diploma",
education == "High school graduate (includes equivalency)" ~ education,
education %in% c("Some college, no degree", "Associate's degree") ~ "Some college or associate's degree",
education %in% c("Bachelor's degree", "Graduate or professional degree") ~ "Bachelor's degree or higher"
)
)%>%
group_by(education, county, ethnicity) %>%
summarize_all(sum)
})
View(bay_educ_latinx_loop)
View(bay_educ_latinx_loop)
View(bay_educ_total_loop)
View(bay_educ_total_loop)
bay_educ_latinx_loop <-
2006:2019 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = x,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(C15002I)"
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
group_by(education, county, ethnicity) %>%
summarize_all(sum)
})
bay_educ_latinx_loop <-
2006:2019 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = x,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(C15002I)"
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
group_by(education, county) %>%
summarize_all(sum)
})
View(bay_educ_latinx_loop)
View(bay_educ_latinx_loop)
bay_educ_white_loop <-
2006:2019 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = x,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(C15002H)"
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate( race = "White, not latinx") %>%
group_by(education, county, race) %>%
summarize_all(sum)
})
bay_educ_latinx_loop <-
2006:2019 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = x,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(C15002I)"
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA, "education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate( race = "White, not latinx") %>%
group_by(education, race, county) %>%
summarize_all(sum)
})
plot_latinx <-
bay_educ_neither %>%
group_by(education, race) %>%
summarize(estimate = sum(estimate)) %>%
rbind(bay_educ_white) %>%
rbind(bay_educ_latinx)
bay_ethnic_total <-
plot_latinx %>%
group_by(race) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
plot_filled_latinx <-
plot_latinx %>%
rbind(bay_ethnic_total) %>%
ggplot() +
geom_bar(
aes(
x = education %>% factor(levels = rev(c("Total", "Less than high school diploma", "High school graduate (includes equivalency)", "Some college or associate's degree", "Bachelor's degree or higher"))),
y = estimate,
fill = race
),
stat = "identity",
position = "fill"
) +
labs(
x = "Level of Educational Attainment",
y = "Number of individuals",
title = "Santa Clara educational attainment by ethnicity",
fill = "Ethnicity of individual"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
plot_filled_latinx

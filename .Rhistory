# Chunk 2
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(devtools)
library(leaflet)
library(plotly)
library(readxl)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
# Chunk 3
acs_vars_2019_5yr <-
listCensusMetadata(
name = "2019/acs/acs5",
type = "variables"
)
# Chunk 4
acs_2019_5yr_all_counties <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = paste0("group(B22005",LETTERS[x],")")
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label)
)  %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,"stamp"),
sep = "!!"
)  %>%
filter(!is.na(stamp)) %>%
mutate(
stamp = case_when(
stamp %in% c("Household received Food Stamps/SNAP in the past 12 months") ~ "Qualify",
stamp %in% c("Household did not receive Food Stamps/SNAP in the past 12 months") ~ "Does Not Qualify"
)
) %>%
mutate(
county = case_when(
county == "001" ~ "Alameda",
county == "013" ~ "Contra Costa",
county == "041" ~ "Marin",
county == "055" ~ "Napa",
county == "075" ~ "San Francisco",
county == "081" ~ "San Mateo",
county == "085" ~ "Santa Clara",
county == "095" ~ "Solano",
county == "097" ~ "Sonoma"
)
)
})
# Chunk 5
race_categories <- c(
"White alone",
"Black or African American alone",
"American Indian and Alaska Native alone",
"Asian alone",
"Native Hawaiian and Other Pacific Islander alone",
"Some Other Race alone",
"Two or more Races"
)
# Chunk 6
# We tried the original ggplot method but chose to move on with the native plotly instead (see below).
# snap_by_county <-
#   acs_2019_5yr_all_counties %>%
#   #filter(CUSTOMERCLASS %in% c("Elec- Residential", "Gas- Residential")) %>%
#   ggplot() +
#   geom_bar(
#     aes(
#       x = county,
#       y = estimate,
#       fill = stamp
#     ),
#     stat = "identity",
#     position = "stack"
#   ) +
#   theme(axis.text.x = element_text(angle = 45)) +
#   labs(
#     x = "Counties",
#     y = "Number of Households",
#     title = "Household Eligibility for SNAP by County",
#     fill = "Eligbility"
#   )
#snap_by_county %>% ggplotly()
# Chunk 7
plot_ly() %>%
add_trace(
data = acs_2019_5yr_all_counties %>% filter(stamp == "Qualify"),
x = ~county,
y = ~estimate,
type = "bar",
name = "Qualify"
) %>%
add_trace(
data = acs_2019_5yr_all_counties %>% filter(stamp == "Does Not Qualify"),
x = ~county,
y = ~estimate,
type = "bar",
name = "Does Not Qualify"
) %>%
layout(
xaxis = list(
title = "Counties",
fixedrange = T
),
yaxis = list(
title = "Number of Household",
fixedrange = T
),
barmode = "stack",
legend = list(title = list(text = "Eligibility"))
) %>%
config(displayModeBar = F)
ca_pumas <-
pumas("CA", cb = T, progress_bar = F)
project_county_names <-
c(
"Alameda",
"San Francisco"
)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% project_county_names)
bay_pumas <-
ca_pumas %>%
st_centroid() %>%
.[bay_counties, ] %>%
st_drop_geometry() %>%
left_join(ca_pumas %>% select(GEOID10)) %>%
st_as_sf()
View(food_vars)
View(food_vars)
food_atlas_clean <-
food_atlas %>%
filter(County %in% project_county_names)
food_atlas_clean <-
food_atlas %>%
filter(County %in% c("Alameda County", "San Francisco County"))
View(food_atlas_clean)
View(food_atlas_clean)
food_atlas_state <- read.csv("SupplementalDataState.csv")
View(food_atlas_state)
food_atlas_state_clean <-
food_atlas_state %>%
filter(State == "CA"))
food_atlas_state_clean <-
food_atlas_state %>%
filter(State == "CA")
View(food_atlas_state_clean)
View(food_atlas_state_clean)
grocery_data <- read.csv("StateAndCountyData.csv")
grocery_data_clean <-
grocery_data %>%
filter(County %in% project_county_names) %>%
mutate(
Variable_Code = case_when(
Variable_Code %in% c("GROC11", "GROC16") ~ "Grocery",
Variable_Code %in% c("SUPERC11", "SUPERC16") ~ "Supercenter",
Variable_Code %in% c("CONVS11", "CONVS16") ~ "Convenience",
Variable_Code %in% c("SPECS11", "SPECS16") ~ "Specialized",
Variable_Code %in% c("SNAPS12", "SNAPS17") ~ "SNAP Authorized",
Variable_Code %in% c("WICS11", "WICS16") ~ "WIC Authorized",
Variable_Code %in% c("FFR11", "FFR16") ~ "Fastfood",
)
) %>%
filter(!is.na(Variable_Code)) %>%
select(-State) %>%
group_by(County, Variable_Code) %>%
summarize_all(sum)
View(grocery_data_clean)
View(grocery_data_clean)
View(grocery_data)
View(grocery_data)
View(grocery_data_clean)
View(grocery_data_clean)
grocery_data_clean <-
grocery_data %>%
filter(County %in% project_county_names)
grocery_data_clean <-
grocery_data %>%
filter(County %in% project_county_names)
View(food_atlas)
View(food_atlas)
data_2019 <- read_excel("FoodAccessResearchAtlasData2019.xlsx")
View(data_2019)
View(data_2019)
data_2019 <- read_excel("FoodAccessResearchAtlasData2019.xlsx", sheet = 3)
View(data_2019)
View(data_2019)
data_2019_clean <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County"))
View(data_2019)
View(data_2019_clean)
data_2019_clean <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(-c("Urban", "State")
data_2019_clean <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(-c("Urban", "State"))
data_2019_clean <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(-c("Urban", "State"))
data_2019_clean <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(-c("Urban", "State", "GroupQuartersFlag", "NUMGQTRS", "PCTGQTRS"))
data_2019_clean <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(-c("Urban", "State", "GroupQuartersFlag", "NUMGQTRS", "PCTGQTRS", "lakids1", "lakids1share", "laseniors1", "laseniors1share"))
View(data_2019_clean)
View(data_2019_clean)
data_2019_clean <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(-c("Urban", "State", "GroupQuartersFlag", "NUMGQTRS", "PCTGQTRS", "lakids1", "lakids1share", "laseniors1", "laseniors1share", "lakids10", "lakids10share", "laseniors10", "laseniors10share", "lakids20", "lakids20share", "laseniors20", "laseniors20share"))
View(data_2019_clean)
sf_food_map <- data_2019_clean %>%
st_as_sf(wkt= "point", crs = 4326)
mapview(sf_food_map)
data_2019_clean <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(-c("Urban", "State", "GroupQuartersFlag", "NUMGQTRS", "PCTGQTRS", "lakids1", "lakids1share", "laseniors1", "laseniors1share", "lakids10", "lakids10share", "laseniors10", "laseniors10share", "lakids20", "lakids20share", "laseniors20", "laseniors20share"))
bay_food_map <- data_2019_clean %>%
st_as_sf(wkt= "point", crs = 4326)
data_2019_clean <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(-c("Urban", "State", "GroupQuartersFlag", "NUMGQTRS", "PCTGQTRS", "lakids1", "lakids1share", "laseniors1", "laseniors1share", "lakids10", "lakids10share", "laseniors10", "laseniors10share", "lakids20", "lakids20share", "laseniors20", "laseniors20share")) %>%
select(c("CensusTract", "LILATracts_1And10"))
bay_food_map <- data_2019_clean %>%
st_as_sf(wkt= "point", crs = 4326)
bay_food_map <- data_2019_clean %>%
st_as_sf(wkt= "point", crs = 4326)
mapview(bay_food_map)
bay_food_map <- data_2019_clean %>%
st_as_sf(wkt= "point", crs = 4326)
bay_food_map <- data_2019_clean %>%
st_as_sf(wkt= "1", crs = 4326)
bay_food_map <- data_2019_clean %>%
st_as_sf(wkt= "CensusTract", crs = 4326)
bay_food_map <- data_2019_clean %>%
st_as_sf(wkt= "CensusTract", crs = 4326)
mapview(bay_food_map)
bay_food_map <- data_2019_clean %>%
st_as_sf(wkt= "LILATracts_1And10", crs = 4326)
bay_food_map <- data_2019_clean %>%
st_as_sf(wkt= "LILATracts_1And10", crs = 4326)
mapview(bay_food_map)
bay_food_map <- data_2019_clean %>%
st_as_sf(wkt= "LILATracts_1And10", crs = 26910)
buffer <- data_2019_clean %>%
st_transform(26910) %>%
st_buffer(800) %>%
st_transform(4269)
mapview(buffer)
buffer <- data_2019_clean %>%
st_transform(26910) %>%
st_buffer(800) %>%
st_transform(4269)
data_with_residuals <-
bay_cardio_poverty_tract %>%
mutate(
Residuals = residuals(model_log)
)
residuals_pal <- colorNumeric(
palette = "Blues",
domain = data_with_residuals$Residuals
)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
data = data_with_residuals,
fillColor = ~residuals_pal(Residuals),
color = "white",
weight = 0.5,
fillOpacity = 0.5,
label = ~Residuals
) %>%
addLegend(
data = data_with_residuals,
pal = residuals_pal,
values = ~Residuals,
title = "Residuals"
)
data_with_residuals <-
bay_cardio_poverty_tract %>%
mutate(
Residuals = residuals(model_log)
)
View(data_2019)
View(data_2019)
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("CensusTract", "County", "lawhite1", "lablack1", "laasian1", "lahopi1", "laaian1", "laomultir1"))
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("CensusTract", "County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1"))
View(data_2019_equity)
View(data_2019_equity)
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("CensusTract", "County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(!is.na(lawhite1)) %>%
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
data_2019 <- read_excel("FoodAccessResearchAtlasData2019.xlsx", sheet = 3)
# data_2019_clean <-
#   data_2019 %>%
#   filter(County %in% c("Alameda County", "San Francisco County")) %>%
#   select(-c("Urban", "State", "GroupQuartersFlag", "NUMGQTRS", "PCTGQTRS", "lakids1", "lakids1share", "laseniors1", "laseniors1share", "lakids10", "lakids10share", "laseniors10", "laseniors10share", "lakids20", "lakids20share", "laseniors20", "laseniors20share")) %>%
#   select(c("CensusTract", "LILATracts_1And10"))
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1"))
data_2019 <- read_excel("FoodAccessResearchAtlasData2019.xlsx", sheet = 3)
knitr::opts_chunk$set(echo = F, warning = F, message = F)
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(devtools)
library(leaflet)
library(plotly)
library(readxl)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
data_2019 <- read_excel("FoodAccessResearchAtlasData2019.xlsx", sheet = 3)
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1"))
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1"))
View(data_2019_equity)
View(data_2019_equity)
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(!is.na(lawhite1)) %>%
# Chunk 1: setup
knitr::opts_chunk$set(echo = F, warning = F, message = F)
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(devtools)
library(leaflet)
library(plotly)
library(readxl)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
data_2019 <- read_excel("FoodAccessResearchAtlasData2019.xlsx", sheet = 3)
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 == "NULL") %>%
mdc kdc
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 == "NULL")
View(data_2019_equity)
View(data_2019_equity)
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL")
View(data_2019_equity)
View(data_2019_equity)
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County)
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise_all()
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise_all("lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise_all(lawhite1, "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise()
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise("lawhite1")
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise(lawhite1)
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise(estimate = sum(estimate)) %>%
ehfbr
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise(estimate = sum(estimate))
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise(estimate = sum(estimate))
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise_all(estimate = sum(estimate))
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise(lawhite1 = sum(lawhite1))
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
#group_by(County) %>%
summarise(lawhite1 = sum(lawhite1))
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise(lawhite1 = sum(lawhite1))
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County)
data_2019_equity <-
data_2019 %>%
filter(County %in% c("Alameda County", "San Francisco County")) %>%
select(c("County", "lawhite1", "lablack1", "laasian1", "lanhopi1", "laaian1", "laomultir1")) %>%
filter(lawhite1 != "NULL") %>%
group_by(County) %>%
summarise_all(sum)
